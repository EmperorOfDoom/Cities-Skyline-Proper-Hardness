//// Generated by .NET Reflector from C:\Projects\Skylines\DifficultyMod\DifficultyMod\libs\Assembly-CSharp.dll
//using ColossalFramework;
//using ColossalFramework.Globalization;
//using ColossalFramework.Math;
//using ColossalFramework.Plugins;
//using ColossalFramework.Steamworks;
//using ColossalFramework.Threading;
//using System;
//using System.Runtime.CompilerServices;
//using System.Runtime.InteropServices;
//using UnityEngine;

//public class ResidentAIMod : HumanAIMod
//{
//    [CompilerGenerated]
//    private static Action f__amcache0;
//    public const int BREED_INTERVAL = 12;
//    public const int CAR_PROBABILITY_ADULT = 20;
//    public const int CAR_PROBABILITY_CHILD = 0;
//    public const int CAR_PROBABILITY_SENIOR = 10;
//    public const int CAR_PROBABILITY_TEEN = 5;
//    public const int CAR_PROBABILITY_YOUNG = 15;
//    public const int GAY_PROBABILITY = 5;
//    public const int UNIVERSITY_DURATION = 15;
    
//    public override void BuildingRelocated(ushort instanceID, ref CitizenInstance data, ushort building)
//    {
//        base.BuildingRelocated(instanceID, ref data, building);
//        if (building == data.m_targetBuilding)
//        {
//            base.InvalidPath(instanceID, ref data);
//        }
//    }
    
//    public bool CanMakeBabies(uint citizenID, ref Citizen data)
//    {
//        if (data.Dead)
//        {
//            return false;
//        }
//        if (Citizen.GetAgeGroup(data.Age) != Citizen.AgeGroup.Adult)
//        {
//            return false;
//        }
//        if ((data.m_flags & Citizen.Flags.MovingIn) != Citizen.Flags.None)
//        {
//            return false;
//        }
//        return true;
//    }
    
//    private void Die(uint citizenID, ref Citizen data)
//    {
//        data.Sick = false;
//        data.Dead = true;
//        data.SetParkedVehicle(citizenID, 0);
//        ushort buildingByLocation = data.GetBuildingByLocation();
//        if (buildingByLocation == 0)
//        {
//            buildingByLocation = data.m_homeBuilding;
//        }
//        if (buildingByLocation != 0)
//        {
//            DistrictManager instance = Singleton<DistrictManager>.instance;
//            Vector3 position = Singleton<BuildingManager>.instance.m_buildings.m_buffer[buildingByLocation].m_position;
//            byte district = instance.GetDistrict(position);
//            instance.m_districts.m_buffer[district].m_deathData.m_tempCount++;
//        }
//    }
    
//    private bool DoRandomMove()
//    {
//        return true;
//        //uint vehicleCount = (uint) Singleton<VehicleManager>.instance.m_vehicleCount;
//        //uint instanceCount = (uint) Singleton<CitizenManager>.instance.m_instanceCount;
//        //if ((vehicleCount * 0x10000) > (instanceCount * 0x4000))
//        //{
//        //    return (Singleton<SimulationManager>.instance.m_randomizer.UInt32(0x4000) > vehicleCount / 4);
//        //}
//        //return (Singleton<SimulationManager>.instance.m_randomizer.UInt32(0x10000) > instanceCount / 4);
//    }
    
//    private bool FindHospital(uint citizenID, ushort sourceBuilding, TransferManager.TransferReason reason)
//    {
//        if (reason == TransferManager.TransferReason.Dead)
//        {
//            if (Singleton<UnlockManager>.instance.Unlocked(UnlockManager.Feature.DeathCare))
//            {
//                return true;
//            }
//            Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//            return false;
//        }
//        if (Singleton<UnlockManager>.instance.Unlocked(ItemClass.Service.HealthCare))
//        {
//            TransferManager.TransferOffer offer = new TransferManager.TransferOffer {
//                Priority = 6,
//                Citizen = citizenID,
//                Position = Singleton<BuildingManager>.instance.m_buildings.m_buffer[sourceBuilding].m_position,
//                Amount = 1,
//                Active = Singleton<SimulationManager>.instance.m_randomizer.Int32(2) == 0
//            };
//            Singleton<TransferManager>.instance.AddOutgoingOffer(reason, offer);
//            return true;
//        }
//        Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//        return false;
//    }
    
//    private void FinishSchoolOrWork(uint citizenID, ref Citizen data)
//    {
//        if (data.m_workBuilding != 0)
//        {
//            if ((data.CurrentLocation == Citizen.Location.Work) && (data.m_homeBuilding != 0))
//            {
//                base.StartMoving(citizenID, ref data, data.m_workBuilding, data.m_homeBuilding);
//            }
//            BuildingManager instance = Singleton<BuildingManager>.instance;
//            CitizenManager manager2 = Singleton<CitizenManager>.instance;
//            uint citizenUnits = instance.m_buildings.m_buffer[data.m_workBuilding].m_citizenUnits;
//            int num2 = 0;
//            while (citizenUnits != 0)
//            {
//                uint nextUnit = manager2.m_units.m_buffer[citizenUnits].m_nextUnit;
//                CitizenUnit.Flags flags = manager2.m_units.m_buffer[citizenUnits].m_flags;
//                if (((ushort) (flags & (CitizenUnit.Flags.None | CitizenUnit.Flags.Student | CitizenUnit.Flags.Work))) != 0)
//                {
//                    if (((ushort) (flags & (CitizenUnit.Flags.None | CitizenUnit.Flags.Student))) != 0)
//                    {
//                        if (data.RemoveFromUnit(citizenID, ref manager2.m_units.m_buffer[citizenUnits]))
//                        {
//                            BuildingInfo info = instance.m_buildings.m_buffer[data.m_workBuilding].Info;
//                            if (info.m_buildingAI.GetEducationLevel1())
//                            {
//                                data.Education1 = true;
//                            }
//                            if (info.m_buildingAI.GetEducationLevel2())
//                            {
//                                data.Education2 = true;
//                            }
//                            if (info.m_buildingAI.GetEducationLevel3())
//                            {
//                                data.Education3 = true;
//                            }
//                            data.m_workBuilding = 0;
//                            data.m_flags &= ~Citizen.Flags.Student;
//                            if ((((data.m_flags & Citizen.Flags.Original) != Citizen.Flags.None) && (data.EducationLevel == Citizen.Education.ThreeSchools)) && ((manager2.m_fullyEducatedOriginalResidents++ == 0) && (Singleton<SimulationManager>.instance.m_metaData.m_disableAchievements != SimulationMetaData.MetaBool.True)))
//                            {
//                                if (f__amcache0 == null)
//                                {
//                                    f__amcache0 = delegate {
//                                        if (!Steam.achievements["ClimbingTheSocialLadder"].achieved)
//                                        {
//                                            Steam.achievements["ClimbingTheSocialLadder"].Unlock();
//                                        }
//                                    };
//                                }
//                                ThreadHelper.dispatcher.Dispatch(f__amcache0);
//                            }
//                            return;
//                        }
//                    }
//                    else if (data.RemoveFromUnit(citizenID, ref manager2.m_units.m_buffer[citizenUnits]))
//                    {
//                        data.m_workBuilding = 0;
//                        data.m_flags &= ~Citizen.Flags.Student;
//                        return;
//                    }
//                }
//                citizenUnits = nextUnit;
//                if (++num2 > 0x80000)
//                {
//                    CODebugBase<LogChannel>.Error(LogChannel.Core, "Invalid list detected!\n" + System.Environment.StackTrace);
//                    break;
//                }
//            }
//        }
//    }
    
//    private int GetCarProbability(Citizen.AgeGroup ageGroup)
//    {
//        switch (ageGroup)
//        {
//            case Citizen.AgeGroup.Child:
//                return 0;
            
//            case Citizen.AgeGroup.Teen:
//                return 5;
            
//            case Citizen.AgeGroup.Young:
//                return 25;
            
//            case Citizen.AgeGroup.Adult:
//                return 35;
            
//            case Citizen.AgeGroup.Senior:
//                return 20;
//        }
//        return 0;
//    }
    
//    public override Color GetColor(ushort instanceID, ref CitizenInstance data, InfoManager.InfoMode infoMode)
//    {

//        return Color.white;
//        InfoManager.InfoMode mode = infoMode;
//        if (mode != InfoManager.InfoMode.Health)
//        {
//            if (mode != InfoManager.InfoMode.Happiness)
//            {
//                return base.GetColor(instanceID, ref data, infoMode);
//            }
//        }
//        else
//        {
//            int num = Singleton<CitizenManager>.instance.m_citizens.m_buffer[data.m_citizen].m_health;
//            return Color.Lerp(Singleton<InfoManager>.instance.m_properties.m_modeProperties[(int) infoMode].m_negativeColor, Singleton<InfoManager>.instance.m_properties.m_modeProperties[(int) infoMode].m_targetColor, ((float) Citizen.GetHealthLevel(num)) * 0.2f);
//        }
//        int health = Singleton<CitizenManager>.instance.m_citizens.m_buffer[data.m_citizen].m_health;
//        int wellbeing = Singleton<CitizenManager>.instance.m_citizens.m_buffer[data.m_citizen].m_wellbeing;
//        int happiness = Citizen.GetHappiness(health, wellbeing);
//        return Color.Lerp(Singleton<InfoManager>.instance.m_properties.m_modeProperties[(int) infoMode].m_negativeColor, Singleton<InfoManager>.instance.m_properties.m_modeProperties[(int) infoMode].m_targetColor, ((float) Citizen.GetHappinessLevel(happiness)) * 0.25f);
//    }
    
//    private TransferManager.TransferReason GetEntertainmentReason()
//    {
//        switch (Singleton<SimulationManager>.instance.m_randomizer.Int32(4))
//        {
//            case 0:
//                return TransferManager.TransferReason.Entertainment;
            
//            case 1:
//                return TransferManager.TransferReason.EntertainmentB;
            
//            case 2:
//                return TransferManager.TransferReason.EntertainmentC;
            
//            case 3:
//                return TransferManager.TransferReason.EntertainmentD;
//        }
//        return TransferManager.TransferReason.Entertainment;
//    }
    
//    public override string GetLocalizedStatus(ushort instanceID, ref CitizenInstance data, out InstanceID target)
//    {
//        CitizenManager instance = Singleton<CitizenManager>.instance;
//        uint citizen = data.m_citizen;
//        bool flag = false;
//        ushort homeBuilding = 0;
//        ushort workBuilding = 0;
//        ushort index = 0;
//        if (citizen != 0)
//        {
//            homeBuilding = instance.m_citizens.m_buffer[citizen].m_homeBuilding;
//            workBuilding = instance.m_citizens.m_buffer[citizen].m_workBuilding;
//            index = instance.m_citizens.m_buffer[citizen].m_vehicle;
//            flag = (instance.m_citizens.m_buffer[citizen].m_flags & Citizen.Flags.Student) != Citizen.Flags.None;
//        }
//        ushort targetBuilding = data.m_targetBuilding;
//        if (targetBuilding != 0)
//        {
//            bool flag2 = (Singleton<BuildingManager>.instance.m_buildings.m_buffer[targetBuilding].m_flags & Building.Flags.IncomingOutgoing) != Building.Flags.None;
//            bool flag3 = (data.m_path == 0) && ((data.m_flags & CitizenInstance.Flags.HangAround) != CitizenInstance.Flags.None);
//            if (index != 0)
//            {
//                VehicleManager manager2 = Singleton<VehicleManager>.instance;
//                VehicleInfo info = manager2.m_vehicles.m_buffer[index].Info;
//                if (info.m_class.m_service == ItemClass.Service.Residential)
//                {
//                    if (info.m_vehicleAI.GetOwnerID(index, ref manager2.m_vehicles.m_buffer[index]).Citizen == citizen)
//                    {
//                        if (flag2)
//                        {
//                            target = InstanceID.Empty;
//                            return Locale.Get("CITIZEN_STATUS_DRIVINGTO_OUTSIDE");
//                        }
//                        if (targetBuilding == homeBuilding)
//                        {
//                            target = InstanceID.Empty;
//                            return Locale.Get("CITIZEN_STATUS_DRIVINGTO_HOME");
//                        }
//                        if (targetBuilding == workBuilding)
//                        {
//                            target = InstanceID.Empty;
//                            return Locale.Get(!flag ? "CITIZEN_STATUS_DRIVINGTO_WORK" : "CITIZEN_STATUS_DRIVINGTO_SCHOOL");
//                        }
//                        target = InstanceID.Empty;
//                        target.Building = targetBuilding;
//                        return Locale.Get("CITIZEN_STATUS_DRIVINGTO");
//                    }
//                }
//                else if (info.m_class.m_service == ItemClass.Service.PublicTransport)
//                {
//                    if (flag2)
//                    {
//                        target = InstanceID.Empty;
//                        return Locale.Get("CITIZEN_STATUS_TRAVELLINGTO_OUTSIDE");
//                    }
//                    if (targetBuilding == homeBuilding)
//                    {
//                        target = InstanceID.Empty;
//                        return Locale.Get("CITIZEN_STATUS_TRAVELLINGTO_HOME");
//                    }
//                    if (targetBuilding == workBuilding)
//                    {
//                        target = InstanceID.Empty;
//                        return Locale.Get(!flag ? "CITIZEN_STATUS_TRAVELLINGTO_WORK" : "CITIZEN_STATUS_TRAVELLINGTO_SCHOOL");
//                    }
//                    target = InstanceID.Empty;
//                    target.Building = targetBuilding;
//                    return Locale.Get("CITIZEN_STATUS_TRAVELLINGTO");
//                }
//            }
//            if (flag2)
//            {
//                target = InstanceID.Empty;
//                return Locale.Get("CITIZEN_STATUS_GOINGTO_OUTSIDE");
//            }
//            if (targetBuilding == homeBuilding)
//            {
//                if (flag3)
//                {
//                    target = InstanceID.Empty;
//                    return Locale.Get("CITIZEN_STATUS_AT_HOME");
//                }
//                target = InstanceID.Empty;
//                return Locale.Get("CITIZEN_STATUS_GOINGTO_HOME");
//            }
//            if (targetBuilding == workBuilding)
//            {
//                if (flag3)
//                {
//                    target = InstanceID.Empty;
//                    return Locale.Get(!flag ? "CITIZEN_STATUS_AT_WORK" : "CITIZEN_STATUS_AT_SCHOOL");
//                }
//                target = InstanceID.Empty;
//                return Locale.Get(!flag ? "CITIZEN_STATUS_GOINGTO_WORK" : "CITIZEN_STATUS_GOINGTO_SCHOOL");
//            }
//            if (flag3)
//            {
//                target = InstanceID.Empty;
//                target.Building = targetBuilding;
//                return Locale.Get("CITIZEN_STATUS_VISITING");
//            }
//            target = InstanceID.Empty;
//            target.Building = targetBuilding;
//            return Locale.Get("CITIZEN_STATUS_GOINGTO");
//        }
//        target = InstanceID.Empty;
//        return Locale.Get("CITIZEN_STATUS_CONFUSED");
//    }
    
//    public override string GetLocalizedStatus(uint citizenID, ref Citizen data, out InstanceID target)
//    {
//        CitizenManager instance = Singleton<CitizenManager>.instance;
//        ushort instanceID = data.m_instance;
//        if (instanceID != 0)
//        {
//            return this.GetLocalizedStatus(instanceID, ref instance.m_instances.m_buffer[instanceID], out target);
//        }
//        Citizen.Location currentLocation = data.CurrentLocation;
//        ushort homeBuilding = data.m_homeBuilding;
//        ushort workBuilding = data.m_workBuilding;
//        ushort visitBuilding = data.m_visitBuilding;
//        bool flag = (data.m_flags & Citizen.Flags.Student) != Citizen.Flags.None;
//        switch (currentLocation)
//        {
//            case Citizen.Location.Home:
//                if (homeBuilding == 0)
//                {
//                    break;
//                }
//                target = InstanceID.Empty;
//                return Locale.Get("CITIZEN_STATUS_AT_HOME");
            
//            case Citizen.Location.Work:
//                if (workBuilding == 0)
//                {
//                    break;
//                }
//                target = InstanceID.Empty;
//                return Locale.Get(!flag ? "CITIZEN_STATUS_AT_WORK" : "CITIZEN_STATUS_AT_SCHOOL");
            
//            case Citizen.Location.Visit:
//                if (visitBuilding == 0)
//                {
//                    break;
//                }
//                target = InstanceID.Empty;
//                target.Building = visitBuilding;
//                return Locale.Get("CITIZEN_STATUS_VISITING");
//        }
//        target = InstanceID.Empty;
//        return Locale.Get("CITIZEN_STATUS_CONFUSED");
//    }
    
//    private TransferManager.TransferReason GetShoppingReason()
//    {
//        switch (Singleton<SimulationManager>.instance.m_randomizer.Int32(8))
//        {
//            case 0:
//                return TransferManager.TransferReason.Shopping;
            
//            case 1:
//                return TransferManager.TransferReason.ShoppingB;
            
//            case 2:
//                return TransferManager.TransferReason.ShoppingC;
            
//            case 3:
//                return TransferManager.TransferReason.ShoppingD;
            
//            case 4:
//                return TransferManager.TransferReason.ShoppingE;
            
//            case 5:
//                return TransferManager.TransferReason.ShoppingF;
            
//            case 6:
//                return TransferManager.TransferReason.ShoppingG;
            
//            case 7:
//                return TransferManager.TransferReason.ShoppingH;
//        }
//        return TransferManager.TransferReason.Shopping;
//    }
    
//    protected override VehicleInfo GetVehicleInfo(ushort instanceID, ref CitizenInstance citizenData, bool forceProbability)
//    {
//        if (citizenData.m_citizen != 0)
//        {
//            int carProbability;
//            int age = Singleton<CitizenManager>.instance.m_citizens.m_buffer[citizenData.m_citizen].Age;
//            if (forceProbability || ((citizenData.m_flags & CitizenInstance.Flags.BorrowCar) != CitizenInstance.Flags.None))
//            {
//                carProbability = 100;
//            }
//            else
//            {
//                carProbability = this.GetCarProbability(Citizen.GetAgeGroup(age));
//            }
//            Randomizer r = new Randomizer(citizenData.m_citizen);
//            if (r.Int32(100) < carProbability)
//            {
//                return Singleton<VehicleManager>.instance.GetRandomVehicleInfo(ref r, ItemClass.Service.Residential, ItemClass.SubService.ResidentialLow, ItemClass.Level.Level1);
//            }
//        }
//        return null;
//    }
    
//    private bool IsRoadConnection(ushort building)
//    {
//        if (building != 0)
//        {
//            BuildingManager instance = Singleton<BuildingManager>.instance;
//            if (((instance.m_buildings.m_buffer[building].m_flags & Building.Flags.IncomingOutgoing) != Building.Flags.None) && (instance.m_buildings.m_buffer[building].Info.m_class.m_service == ItemClass.Service.Road))
//            {
//                return true;
//            }
//        }
//        return false;
//    }
    
//    public override void JoinTarget(ushort instanceID, ref CitizenInstance data, ushort otherInstance)
//    {
//        ushort targetBuilding = 0;
//        if (otherInstance != 0)
//        {
//            targetBuilding = Singleton<CitizenManager>.instance.m_instances.m_buffer[otherInstance].m_targetBuilding;
//        }
//        if (targetBuilding != data.m_targetBuilding)
//        {
//            if (data.m_targetBuilding != 0)
//            {
//                Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_targetBuilding].RemoveTargetCitizen(instanceID, ref data);
//            }
//            data.m_targetBuilding = targetBuilding;
//            if (data.m_targetBuilding != 0)
//            {
//                Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_targetBuilding].AddTargetCitizen(instanceID, ref data);
//            }
//        }
//        if (otherInstance != 0)
//        {
//            PathManager instance = Singleton<PathManager>.instance;
//            CitizenManager manager2 = Singleton<CitizenManager>.instance;
//            data.Unspawn(instanceID);
//            CitizenInstance.Frame lastFrameData = manager2.m_instances.m_buffer[otherInstance].GetLastFrameData();
//            data.m_frame0 = lastFrameData;
//            data.m_frame1 = lastFrameData;
//            data.m_frame2 = lastFrameData;
//            data.m_frame3 = lastFrameData;
//            data.m_targetPos = manager2.m_instances.m_buffer[otherInstance].m_targetPos;
//            uint path = manager2.m_instances.m_buffer[otherInstance].m_path;
//            if (instance.AddPathReference(path))
//            {
//                if (data.m_path != 0)
//                {
//                    instance.ReleasePath(data.m_path);
//                }
//                data.m_path = path;
//                if ((manager2.m_instances.m_buffer[otherInstance].m_flags & CitizenInstance.Flags.WaitingPath) != CitizenInstance.Flags.None)
//                {
//                    data.m_flags |= CitizenInstance.Flags.WaitingPath;
//                }
//                else
//                {
//                    data.Spawn(instanceID);
//                }
//            }
//        }
//    }
    
//    public override void LoadInstance(ushort instanceID, ref CitizenInstance data)
//    {
//        base.LoadInstance(instanceID, ref data);
//        if (data.m_sourceBuilding != 0)
//        {
//            Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_sourceBuilding].AddSourceCitizen(instanceID, ref data);
//        }
//        if (data.m_targetBuilding != 0)
//        {
//            Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_targetBuilding].AddTargetCitizen(instanceID, ref data);
//        }
//    }
    
//    private void MoveFamily(uint homeID, ref CitizenUnit data, ushort targetBuilding)
//    {
//        BuildingManager instance = Singleton<BuildingManager>.instance;
//        CitizenManager manager2 = Singleton<CitizenManager>.instance;
//        uint unitID = 0;
//        if (targetBuilding != 0)
//        {
//            unitID = instance.m_buildings.m_buffer[targetBuilding].GetEmptyCitizenUnit(CitizenUnit.Flags.Home);
//        }
//        for (int i = 0; i < 5; i++)
//        {
//            uint citizen = data.GetCitizen(i);
//            if ((citizen != 0) && !manager2.m_citizens.m_buffer[citizen].Dead)
//            {
//                manager2.m_citizens.m_buffer[citizen].SetHome(citizen, 0, unitID);
//                if (manager2.m_citizens.m_buffer[citizen].m_homeBuilding == 0)
//                {
//                    manager2.ReleaseCitizen(citizen);
//                }
//            }
//        }
//    }
    
//    protected override void PathfindSuccess(ushort instanceID, ref CitizenInstance data)
//    {
//        uint citizen = data.m_citizen;
//        if ((citizen != 0) && ((Singleton<CitizenManager>.instance.m_citizens.m_buffer[citizen].m_flags & (Citizen.Flags.DummyTraffic | Citizen.Flags.MovingIn)) == Citizen.Flags.MovingIn))
//        {
//            Singleton<StatisticsManager>.instance.Acquire<StatisticInt32>(StatisticType.MoveRate).Add(1);
//        }
//        base.PathfindSuccess(instanceID, ref data);
//    }
    
//    public override void SetRenderParameters(RenderManager.CameraInfo cameraInfo, ushort instanceID, ref CitizenInstance data, Vector3 position, Quaternion rotation, Vector3 velocity, Color color, bool underground)
//    {
//        if ((data.m_flags & CitizenInstance.Flags.AtTarget) != CitizenInstance.Flags.None)
//        {
//            if ((data.m_flags & CitizenInstance.Flags.SittingDown) != CitizenInstance.Flags.None)
//            {
//                base.m_info.SetRenderParameters(position, rotation, velocity, color, 2, underground);
//                return;
//            }
//            if ((data.m_flags & CitizenInstance.Flags.Panicking) != CitizenInstance.Flags.None)
//            {
//                base.m_info.SetRenderParameters(position, rotation, velocity, color, 1, underground);
//                return;
//            }
//        }
//        base.m_info.SetRenderParameters(position, rotation, velocity, color, 0, underground);
//    }
    
//    public override void SetSource(ushort instanceID, ref CitizenInstance data, ushort sourceBuilding)
//    {
//        if (sourceBuilding != data.m_sourceBuilding)
//        {
//            if (data.m_sourceBuilding != 0)
//            {
//                Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_sourceBuilding].RemoveSourceCitizen(instanceID, ref data);
//            }
//            data.m_sourceBuilding = sourceBuilding;
//            if (data.m_sourceBuilding != 0)
//            {
//                Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_sourceBuilding].AddSourceCitizen(instanceID, ref data);
//            }
//        }
//        if (sourceBuilding != 0)
//        {
//            Vector3 vector;
//            Vector3 vector2;
//            BuildingManager instance = Singleton<BuildingManager>.instance;
//            BuildingInfo info = instance.m_buildings.m_buffer[sourceBuilding].Info;
//            data.Unspawn(instanceID);
//            Randomizer randomizer = new Randomizer((int) instanceID);
//            info.m_buildingAI.CalculateSpawnPosition(sourceBuilding, ref instance.m_buildings.m_buffer[sourceBuilding], ref randomizer, base.m_info, out vector, out vector2);
//            Quaternion identity = Quaternion.identity;
//            Vector3 forward = vector2 - vector;
//            if (forward.sqrMagnitude > 0.01f)
//            {
//                identity = Quaternion.LookRotation(forward);
//            }
//            data.m_frame0.m_velocity = Vector3.zero;
//            data.m_frame0.m_position = vector;
//            data.m_frame0.m_rotation = identity;
//            data.m_frame1 = data.m_frame0;
//            data.m_frame2 = data.m_frame0;
//            data.m_frame3 = data.m_frame0;
//            data.m_targetPos = new Vector4(vector2.x, vector2.y, vector2.z, 1f);
//        }
//    }
    
//    public override void SetTarget(ushort instanceID, ref CitizenInstance data, ushort targetBuilding)
//    {
//        if (targetBuilding != data.m_targetBuilding)
//        {
//            if (data.m_targetBuilding != 0)
//            {
//                Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_targetBuilding].RemoveTargetCitizen(instanceID, ref data);
//            }
//            data.m_targetBuilding = targetBuilding;
//            if (data.m_targetBuilding != 0)
//            {
//                Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_targetBuilding].AddTargetCitizen(instanceID, ref data);
//                data.m_targetSeed = (byte) Singleton<SimulationManager>.instance.m_randomizer.Int32(0x100);
//            }
//        }
//        if (this.IsRoadConnection(targetBuilding) || this.IsRoadConnection(data.m_sourceBuilding))
//        {
//            data.m_flags |= CitizenInstance.Flags.BorrowCar;
//        }
//        else
//        {
//            data.m_flags &= ~CitizenInstance.Flags.BorrowCar;
//        }
//        if (!this.StartPathFind(instanceID, ref data))
//        {
//            data.Unspawn(instanceID);
//        }
//    }
    
//    public override void SimulationStep(uint citizenID, ref Citizen data)
//    {
//        if (data.Dead || !this.UpdateAge(citizenID, ref data))
//        {
//            if (!data.Dead)
//            {
//                this.UpdateHome(citizenID, ref data);
//            }
//            if (!data.Sick && !data.Dead)
//            {
//                if (this.UpdateHealth(citizenID, ref data))
//                {
//                    return;
//                }
//                this.UpdateWellbeing(citizenID, ref data);
//                this.UpdateWorkplace(citizenID, ref data);
//            }
//            this.UpdateLocation(citizenID, ref data);
//        }
//    }
    
//    public override void SimulationStep(uint homeID, ref CitizenUnit data)
//    {
//        CitizenManager instance = Singleton<CitizenManager>.instance;
//        ushort building = instance.m_units.m_buffer[homeID].m_building;
//        if (((data.m_citizen0 != 0) && (data.m_citizen1 != 0)) && (((data.m_citizen2 == 0) || (data.m_citizen3 == 0)) || (data.m_citizen4 == 0)))
//        {
//            bool flag = this.CanMakeBabies(data.m_citizen0, ref instance.m_citizens.m_buffer[data.m_citizen0]);
//            bool flag2 = this.CanMakeBabies(data.m_citizen1, ref instance.m_citizens.m_buffer[data.m_citizen1]);
//            if ((flag && flag2) && (Singleton<SimulationManager>.instance.m_randomizer.Int32(12) == 0))
//            {
//                uint num3;
//                int family = instance.m_citizens.m_buffer[data.m_citizen0].m_family;
//                if (instance.CreateCitizen(out num3, 0, family, ref Singleton<SimulationManager>.instance.m_randomizer))
//                {
//                    instance.m_citizens.m_buffer[num3].SetHome(num3, 0, homeID);
//                    instance.m_citizens.m_buffer[num3].m_flags |= Citizen.Flags.Original;
//                    if (building != 0)
//                    {
//                        DistrictManager manager2 = Singleton<DistrictManager>.instance;
//                        Vector3 position = Singleton<BuildingManager>.instance.m_buildings.m_buffer[building].m_position;
//                        byte district = manager2.GetDistrict(position);
//                        manager2.m_districts.m_buffer[district].m_birthData.m_tempCount++;
//                    }
//                }
//            }
//        }
//        if ((data.m_citizen0 != 0) && (data.m_citizen1 == 0))
//        {
//            this.TryFindPartner(data.m_citizen0, ref instance.m_citizens.m_buffer[data.m_citizen0]);
//        }
//        else if ((data.m_citizen1 != 0) && (data.m_citizen0 == 0))
//        {
//            this.TryFindPartner(data.m_citizen1, ref instance.m_citizens.m_buffer[data.m_citizen1]);
//        }
//        if (data.m_citizen2 != 0)
//        {
//            this.TryMoveAwayFromHome(data.m_citizen2, ref instance.m_citizens.m_buffer[data.m_citizen2]);
//        }
//        if (data.m_citizen3 != 0)
//        {
//            this.TryMoveAwayFromHome(data.m_citizen3, ref instance.m_citizens.m_buffer[data.m_citizen3]);
//        }
//        if (data.m_citizen4 != 0)
//        {
//            this.TryMoveAwayFromHome(data.m_citizen4, ref instance.m_citizens.m_buffer[data.m_citizen4]);
//        }
//        data.m_goods = (ushort) Mathf.Max(0, data.m_goods - 20);
//        if (data.m_goods < 200)
//        {
//            int num5 = Singleton<SimulationManager>.instance.m_randomizer.Int32(5);
//            for (int i = 0; i < 5; i++)
//            {
//                uint citizen = data.GetCitizen((num5 + i) % 5);
//                if (citizen != 0)
//                {
//                    instance.m_citizens.m_buffer[citizen].m_flags |= Citizen.Flags.NeedGoods;
//                    break;
//                }
//            }
//        }
//        if ((building != 0) && ((Singleton<BuildingManager>.instance.m_buildings.m_buffer[building].m_problems & (Notification.Problem.MajorProblem | Notification.Problem.FatalProblem)) != Notification.Problem.None))
//        {
//            uint citizenID = 0;
//            int familySize = 0;
//            if ((data.m_citizen4 != 0) && !instance.m_citizens.m_buffer[data.m_citizen4].Dead)
//            {
//                familySize++;
//                citizenID = data.m_citizen4;
//            }
//            if ((data.m_citizen3 != 0) && !instance.m_citizens.m_buffer[data.m_citizen3].Dead)
//            {
//                familySize++;
//                citizenID = data.m_citizen3;
//            }
//            if ((data.m_citizen2 != 0) && !instance.m_citizens.m_buffer[data.m_citizen2].Dead)
//            {
//                familySize++;
//                citizenID = data.m_citizen2;
//            }
//            if ((data.m_citizen1 != 0) && !instance.m_citizens.m_buffer[data.m_citizen1].Dead)
//            {
//                familySize++;
//                citizenID = data.m_citizen1;
//            }
//            if ((data.m_citizen0 != 0) && !instance.m_citizens.m_buffer[data.m_citizen0].Dead)
//            {
//                familySize++;
//                citizenID = data.m_citizen0;
//            }
//            if (citizenID != 0)
//            {
//                this.TryMoveFamily(citizenID, ref instance.m_citizens.m_buffer[citizenID], familySize);
//            }
//        }
//    }
    
//    public override void SimulationStep(ushort instanceID, ref CitizenInstance citizenData, ref CitizenInstance.Frame frameData, bool lodPhysics)
//    {
//        if (((Singleton<SimulationManager>.instance.m_currentFrameIndex >> 4) & 0x3f) == (instanceID & 0x3f))
//        {
//            CitizenManager instance = Singleton<CitizenManager>.instance;
//            uint citizen = citizenData.m_citizen;
//            if ((citizen != 0) && ((instance.m_citizens.m_buffer[citizen].m_flags & Citizen.Flags.NeedGoods) != Citizen.Flags.None))
//            {
//                BuildingManager manager2 = Singleton<BuildingManager>.instance;
//                ushort homeBuilding = instance.m_citizens.m_buffer[citizen].m_homeBuilding;
//                ushort index = manager2.FindBuilding(frameData.m_position, 32f, ItemClass.Service.Commercial, ItemClass.SubService.None, Building.Flags.Active | Building.Flags.Created, Building.Flags.Deleted);
//                if ((homeBuilding != 0) && (index != 0))
//                {
//                    BuildingInfo info = manager2.m_buildings.m_buffer[index].Info;
//                    int amountDelta = -100;
//                    info.m_buildingAI.ModifyMaterialBuffer(index, ref manager2.m_buildings.m_buffer[index], TransferManager.TransferReason.Shopping, ref amountDelta);
//                    uint num6 = instance.m_citizens.m_buffer[citizen].GetContainingUnit(citizen, manager2.m_buildings.m_buffer[homeBuilding].m_citizenUnits, CitizenUnit.Flags.Home);
//                    if (num6 != 0)
//                    {
//                        instance.m_units.m_buffer[num6].m_goods = (ushort)(instance.m_units.m_buffer[num6].m_goods + ((ushort)-amountDelta));
//                    }
//                    instance.m_citizens.m_buffer[citizen].m_flags &= ~Citizen.Flags.NeedGoods;
//                }
//            }
//        }
//        base.SimulationStep(instanceID, ref citizenData, ref frameData, lodPhysics);
//    }
    
//    protected override void Spawn(ushort instanceID, ref CitizenInstance data)
//    {
//        if ((data.m_flags & CitizenInstance.Flags.Character) == CitizenInstance.Flags.None)
//        {
//            data.Spawn(instanceID);
//            uint citizen = data.m_citizen;
//            ushort targetBuilding = data.m_targetBuilding;
//            if ((citizen != 0) && (targetBuilding != 0))
//            {
//                Randomizer r = new Randomizer(citizen);
//                if (r.Int32(20) == 0)
//                {
//                    CitizenManager instance = Singleton<CitizenManager>.instance;
//                    BuildingManager manager2 = Singleton<BuildingManager>.instance;
//                    DistrictManager manager3 = Singleton<DistrictManager>.instance;
//                    Vector3 position = manager2.m_buildings.m_buffer[targetBuilding].m_position;
//                    byte district = manager3.GetDistrict((Vector3) data.m_targetPos);
//                    byte index = manager3.GetDistrict(position);
//                    DistrictPolicies.Services servicePolicies = manager3.m_districts.m_buffer[district].m_servicePolicies;
//                    DistrictPolicies.Services services2 = manager3.m_districts.m_buffer[index].m_servicePolicies;
//                    if (((servicePolicies | services2) & DistrictPolicies.Services.PetBan) == DistrictPolicies.Services.None)
//                    {
//                        ushort num5;
//                        CitizenInfo info = instance.GetGroupAnimalInfo(ref r, base.m_info.m_class.m_service, base.m_info.m_class.m_subService);
//                        if ((info != null) && instance.CreateCitizenInstance(out num5, ref r, info, 0))
//                        {
//                            info.m_citizenAI.SetSource(num5, ref instance.m_instances.m_buffer[num5], instanceID);
//                            info.m_citizenAI.SetTarget(num5, ref instance.m_instances.m_buffer[num5], instanceID);
//                        }
//                    }
//                }
//            }
//        }
//    }
    
//    protected override bool SpawnVehicle(ushort instanceID, ref CitizenInstance citizenData, PathUnit.Position pathPos)
//    {
//        float num12;
//        Vector3 vector3;
//        ushort num14;
//        VehicleManager instance = Singleton<VehicleManager>.instance;
//        float num = 20f;
//        int num2 = Mathf.Max((int) (((citizenData.m_targetPos.x - num) / 32f) + 270f), 0);
//        int num3 = Mathf.Max((int) (((citizenData.m_targetPos.z - num) / 32f) + 270f), 0);
//        int num4 = Mathf.Min((int) (((citizenData.m_targetPos.x + num) / 32f) + 270f), 0x21b);
//        int num5 = Mathf.Min((int) (((citizenData.m_targetPos.z + num) / 32f) + 270f), 0x21b);
//        for (int i = num3; i <= num5; i++)
//        {
//            for (int j = num2; j <= num4; j++)
//            {
//                ushort vehicleID = instance.m_vehicleGrid[(i * 540) + j];
//                int num9 = 0;
//                while (vehicleID != 0)
//                {
//                    if (this.TryJoinVehicle(instanceID, ref citizenData, vehicleID, ref instance.m_vehicles.m_buffer[vehicleID]))
//                    {
//                        citizenData.m_flags |= CitizenInstance.Flags.EnteringVehicle;
//                        citizenData.m_flags &= ~CitizenInstance.Flags.TryingSpawnVehicle;
//                        citizenData.m_flags &= ~CitizenInstance.Flags.BoredOfWaiting;
//                        citizenData.m_waitCounter = 0;
//                        return true;
//                    }
//                    vehicleID = instance.m_vehicles.m_buffer[vehicleID].m_nextGridVehicle;
//                    if (++num9 > 0x4000)
//                    {
//                        CODebugBase<LogChannel>.Error(LogChannel.Core, "Invalid list detected!\n" + System.Environment.StackTrace);
//                        break;
//                    }
//                }
//            }
//        }
//        NetManager manager2 = Singleton<NetManager>.instance;
//        CitizenManager manager3 = Singleton<CitizenManager>.instance;
//        Vector3 zero = Vector3.zero;
//        Quaternion identity = Quaternion.identity;
//        ushort parkedVehicle = manager3.m_citizens.m_buffer[citizenData.m_citizen].m_parkedVehicle;
//        if (parkedVehicle != 0)
//        {
//            zero = instance.m_parkedVehicles.m_buffer[parkedVehicle].m_position;
//            identity = instance.m_parkedVehicles.m_buffer[parkedVehicle].m_rotation;
//        }
//        VehicleInfo info = this.GetVehicleInfo(instanceID, ref citizenData, false);
//        if (info == null)
//        {
//            manager3.m_citizens.m_buffer[citizenData.m_citizen].SetParkedVehicle(citizenData.m_citizen, 0);
//            if ((citizenData.m_flags & CitizenInstance.Flags.TryingSpawnVehicle) == CitizenInstance.Flags.None)
//            {
//                citizenData.m_flags |= CitizenInstance.Flags.TryingSpawnVehicle;
//                citizenData.m_flags &= ~CitizenInstance.Flags.BoredOfWaiting;
//                citizenData.m_waitCounter = 0;
//            }
//            return true;
//        }
//        uint laneID = PathManager.GetLaneID(pathPos);
//        Vector3 targetPos = (Vector3) citizenData.m_targetPos;
//        if ((parkedVehicle != 0) && (Vector3.SqrMagnitude(zero - targetPos) < 1024f))
//        {
//            targetPos = zero;
//        }
//        else
//        {
//            parkedVehicle = 0;
//        }
//        manager2.m_lanes.m_buffer[laneID].GetClosestPosition(targetPos, out vector3, out num12);
//        byte num13 = (byte) Mathf.Clamp(Mathf.RoundToInt(num12 * 255f), 0, 0xff);
//        vector3 = targetPos + Vector3.ClampMagnitude(vector3 - targetPos, 5f);
//        if (instance.CreateVehicle(out num14, ref Singleton<SimulationManager>.instance.m_randomizer, info, targetPos, TransferManager.TransferReason.None, false, false))
//        {
//            Vehicle.Frame frameData = instance.m_vehicles.m_buffer[num14].m_frame0;
//            if (parkedVehicle != 0)
//            {
//                frameData.m_rotation = identity;
//            }
//            else
//            {
//                Vector3 forward = vector3 - citizenData.GetLastFrameData().m_position;
//                if (forward.sqrMagnitude > 0.01f)
//                {
//                    frameData.m_rotation = Quaternion.LookRotation(forward);
//                }
//            }
//            instance.m_vehicles.m_buffer[num14].m_frame0 = frameData;
//            instance.m_vehicles.m_buffer[num14].m_frame1 = frameData;
//            instance.m_vehicles.m_buffer[num14].m_frame2 = frameData;
//            instance.m_vehicles.m_buffer[num14].m_frame3 = frameData;
//            info.m_vehicleAI.FrameDataUpdated(num14, ref instance.m_vehicles.m_buffer[num14], ref frameData);
//            instance.m_vehicles.m_buffer[num14].m_targetPos0 = new Vector4(vector3.x, vector3.y, vector3.z, 2f);
//            instance.m_vehicles.m_buffer[num14].m_flags |= Vehicle.Flags.Stopped;
//            instance.m_vehicles.m_buffer[num14].m_path = citizenData.m_path;
//            instance.m_vehicles.m_buffer[num14].m_pathPositionIndex = citizenData.m_pathPositionIndex;
//            instance.m_vehicles.m_buffer[num14].m_lastPathOffset = num13;
//            instance.m_vehicles.m_buffer[num14].m_transferSize = (ushort) (citizenData.m_citizen & 0xffff);
//            info.m_vehicleAI.TrySpawn(num14, ref instance.m_vehicles.m_buffer[num14]);
//            if (parkedVehicle != 0)
//            {
//                InstanceID empty = InstanceID.Empty;
//                empty.ParkedVehicle = parkedVehicle;
//                InstanceID newID = InstanceID.Empty;
//                newID.Vehicle = num14;
//                Singleton<InstanceManager>.instance.ChangeInstance(empty, newID);
//            }
//            citizenData.m_path = 0;
//            manager3.m_citizens.m_buffer[citizenData.m_citizen].SetParkedVehicle(citizenData.m_citizen, 0);
//            manager3.m_citizens.m_buffer[citizenData.m_citizen].SetVehicle(citizenData.m_citizen, num14, 0);
//            citizenData.m_flags |= CitizenInstance.Flags.EnteringVehicle;
//            citizenData.m_flags &= ~CitizenInstance.Flags.TryingSpawnVehicle;
//            citizenData.m_flags &= ~CitizenInstance.Flags.BoredOfWaiting;
//            citizenData.m_waitCounter = 0;
//            return true;
//        }
//        manager3.m_citizens.m_buffer[citizenData.m_citizen].SetParkedVehicle(citizenData.m_citizen, 0);
//        if ((citizenData.m_flags & CitizenInstance.Flags.TryingSpawnVehicle) == CitizenInstance.Flags.None)
//        {
//            citizenData.m_flags |= CitizenInstance.Flags.TryingSpawnVehicle;
//            citizenData.m_flags &= ~CitizenInstance.Flags.BoredOfWaiting;
//            citizenData.m_waitCounter = 0;
//        }
//        return true;
//    }
    
//    protected override bool StartPathFind(ushort instanceID, ref CitizenInstance citizenData)
//    {
//        if (citizenData.m_citizen != 0)
//        {
//            CitizenManager instance = Singleton<CitizenManager>.instance;
//            VehicleManager manager2 = Singleton<VehicleManager>.instance;
//            ushort vehicle = instance.m_citizens.m_buffer[citizenData.m_citizen].m_vehicle;
//            if (vehicle != 0)
//            {
//                VehicleInfo info = manager2.m_vehicles.m_buffer[vehicle].Info;
//                if (info.m_vehicleAI.GetOwnerID(vehicle, ref manager2.m_vehicles.m_buffer[vehicle]).Citizen == citizenData.m_citizen)
//                {
//                    info.m_vehicleAI.SetTarget(vehicle, ref manager2.m_vehicles.m_buffer[vehicle], 0);
//                }
//                else
//                {
//                    instance.m_citizens.m_buffer[citizenData.m_citizen].SetVehicle(citizenData.m_citizen, 0, 0);
//                }
//                return false;
//            }
//        }
//        if (citizenData.m_targetBuilding != 0)
//        {
//            Vector3 vector;
//            Vector3 vector2;
//            Vector2 vector3;
//            CitizenInstance.Flags flags;
//            VehicleInfo vehicleInfo = this.GetVehicleInfo(instanceID, ref citizenData, false);
//            BuildingManager manager3 = Singleton<BuildingManager>.instance;
//            BuildingInfo info3 = manager3.m_buildings.m_buffer[citizenData.m_targetBuilding].Info;
//            Randomizer randomizer = new Randomizer((instanceID << 8) | citizenData.m_targetSeed);
//            info3.m_buildingAI.CalculateUnspawnPosition(citizenData.m_targetBuilding, ref manager3.m_buildings.m_buffer[citizenData.m_targetBuilding], ref randomizer, base.m_info, instanceID, out vector, out vector2, out vector3, out flags);
//            return base.StartPathFind(instanceID, ref citizenData, (Vector3) citizenData.m_targetPos, vector2, vehicleInfo);
//        }
//        return false;
//    }
    
//    public override void StartTransfer(uint citizenID, ref Citizen data, TransferManager.TransferReason reason, TransferManager.TransferOffer offer)
//    {
//        if ((data.m_flags != Citizen.Flags.None) && (!data.Dead || (reason == TransferManager.TransferReason.Dead)))
//        {
//            switch (reason)
//            {
//                case TransferManager.TransferReason.Sick:
//                    if (data.Sick && base.StartMoving(citizenID, ref data, 0, offer.Building))
//                    {
//                        data.SetVisitplace(citizenID, offer.Building, 0);
//                    }
//                    return;
                
//                case TransferManager.TransferReason.Dead:
//                    if (data.Dead)
//                    {
//                        data.SetVisitplace(citizenID, offer.Building, 0);
//                        if (data.m_visitBuilding != 0)
//                        {
//                            data.CurrentLocation = Citizen.Location.Visit;
//                        }
//                    }
//                    return;
                
//                case TransferManager.TransferReason.Worker0:
//                case TransferManager.TransferReason.Worker1:
//                case TransferManager.TransferReason.Worker2:
//                case TransferManager.TransferReason.Worker3:
//                    if (data.m_workBuilding == 0)
//                    {
//                        data.SetWorkplace(citizenID, offer.Building, 0);
//                    }
//                    return;
                
//                case TransferManager.TransferReason.Student1:
//                case TransferManager.TransferReason.Student2:
//                case TransferManager.TransferReason.Student3:
//                    if (data.m_workBuilding == 0)
//                    {
//                        data.SetStudentplace(citizenID, offer.Building, 0);
//                    }
//                    return;
                
//                case TransferManager.TransferReason.Family0:
//                case TransferManager.TransferReason.Family1:
//                case TransferManager.TransferReason.Family2:
//                case TransferManager.TransferReason.Family3:
//                    if ((data.m_homeBuilding != 0) && (offer.Building != 0))
//                    {
//                        uint homeID = Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_homeBuilding].FindCitizenUnit(CitizenUnit.Flags.Home, citizenID);
//                        if (homeID != 0)
//                        {
//                            this.MoveFamily(homeID, ref Singleton<CitizenManager>.instance.m_units.m_buffer[homeID], offer.Building);
//                        }
//                    }
//                    return;
                
//                case TransferManager.TransferReason.Single0:
//                case TransferManager.TransferReason.Single1:
//                case TransferManager.TransferReason.Single2:
//                case TransferManager.TransferReason.Single3:
//                case TransferManager.TransferReason.Single0B:
//                case TransferManager.TransferReason.Single1B:
//                case TransferManager.TransferReason.Single2B:
//                case TransferManager.TransferReason.Single3B:
//                    data.SetHome(citizenID, offer.Building, 0);
//                    if (data.m_homeBuilding == 0)
//                    {
//                        Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//                    }
//                    return;
                
//                case TransferManager.TransferReason.PartnerYoung:
//                case TransferManager.TransferReason.PartnerAdult:
//                {
//                    uint citizen = offer.Citizen;
//                    if (citizen != 0)
//                    {
//                        CitizenManager instance = Singleton<CitizenManager>.instance;
//                        BuildingManager manager4 = Singleton<BuildingManager>.instance;
//                        ushort homeBuilding = instance.m_citizens.m_buffer[citizen].m_homeBuilding;
//                        if ((homeBuilding != 0) && !instance.m_citizens.m_buffer[citizen].Dead)
//                        {
//                            uint unitID = manager4.m_buildings.m_buffer[homeBuilding].FindCitizenUnit(CitizenUnit.Flags.Home, citizen);
//                            if (unitID != 0)
//                            {
//                                data.SetHome(citizenID, 0, unitID);
//                                data.m_family = instance.m_citizens.m_buffer[citizen].m_family;
//                            }
//                        }
//                    }
//                    return;
//                }
//                case TransferManager.TransferReason.Shopping:
//                case TransferManager.TransferReason.ShoppingB:
//                case TransferManager.TransferReason.ShoppingC:
//                case TransferManager.TransferReason.ShoppingD:
//                case TransferManager.TransferReason.ShoppingE:
//                case TransferManager.TransferReason.ShoppingF:
//                case TransferManager.TransferReason.ShoppingG:
//                case TransferManager.TransferReason.ShoppingH:
//                    if (((data.m_homeBuilding != 0) && !data.Sick) && base.StartMoving(citizenID, ref data, 0, offer.Building))
//                    {
//                        data.SetVisitplace(citizenID, offer.Building, 0);
//                        CitizenManager manager = Singleton<CitizenManager>.instance;
//                        BuildingManager manager2 = Singleton<BuildingManager>.instance;
//                        uint index = data.GetContainingUnit(citizenID, manager2.m_buildings.m_buffer[data.m_homeBuilding].m_citizenUnits, CitizenUnit.Flags.Home);
//                        if (index != 0)
//                        {
//                            manager.m_units.m_buffer[index].m_goods = (ushort) (manager.m_units.m_buffer[index].m_goods + 100);
//                        }
//                    }
//                    return;
                
//                case TransferManager.TransferReason.Entertainment:
//                case TransferManager.TransferReason.EntertainmentB:
//                case TransferManager.TransferReason.EntertainmentC:
//                case TransferManager.TransferReason.EntertainmentD:
//                    if (((data.m_homeBuilding != 0) && !data.Sick) && base.StartMoving(citizenID, ref data, 0, offer.Building))
//                    {
//                        data.SetVisitplace(citizenID, offer.Building, 0);
//                    }
//                    return;
//            }
//        }
//    }
    
//    public void TryFindPartner(uint citizenID, ref Citizen data)
//    {
//        if (!data.Dead && (data.m_homeBuilding != 0))
//        {
//            Citizen.AgeGroup ageGroup = Citizen.GetAgeGroup(data.Age);
//            TransferManager.TransferReason none = TransferManager.TransferReason.None;
//            switch (ageGroup)
//            {
//                case Citizen.AgeGroup.Young:
//                    none = TransferManager.TransferReason.PartnerYoung;
//                    break;
                
//                case Citizen.AgeGroup.Adult:
//                    none = TransferManager.TransferReason.PartnerAdult;
//                    break;
//            }
//            switch (ageGroup)
//            {
//                case Citizen.AgeGroup.Young:
//                case Citizen.AgeGroup.Adult:
//                {
//                    Vector3 position = Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_homeBuilding].m_position;
//                    byte district = Singleton<DistrictManager>.instance.GetDistrict(position);
//                    DistrictPolicies.Special specialPolicies = Singleton<DistrictManager>.instance.m_districts.m_buffer[district].m_specialPolicies;
//                    TransferManager.TransferOffer offer = new TransferManager.TransferOffer {
//                        Priority = Singleton<SimulationManager>.instance.m_randomizer.Int32(8),
//                        Citizen = citizenID,
//                        Position = position,
//                        Amount = 1,
//                        Active = Singleton<SimulationManager>.instance.m_randomizer.Int32(2) == 0
//                    };
//                    bool flag = Singleton<SimulationManager>.instance.m_randomizer.Int32(100) < 5;
//                    if (!flag || ((specialPolicies & DistrictPolicies.Special.NoHomo) == DistrictPolicies.Special.None))
//                    {
//                        if ((Citizen.GetGender(citizenID) == Citizen.Gender.Female) != flag)
//                        {
//                            Singleton<TransferManager>.instance.AddIncomingOffer(none, offer);
//                        }
//                        else
//                        {
//                            Singleton<TransferManager>.instance.AddOutgoingOffer(none, offer);
//                        }
//                    }
//                    break;
//                }
//            }
//        }
//    }
    
//    private bool TryJoinVehicle(ushort instanceID, ref CitizenInstance citizenData, ushort vehicleID, ref Vehicle vehicleData)
//    {
//        if ((vehicleData.m_flags & Vehicle.Flags.Stopped) != Vehicle.Flags.None)
//        {
//            CitizenManager instance = Singleton<CitizenManager>.instance;
//            uint citizenUnits = vehicleData.m_citizenUnits;
//            int num2 = 0;
//            while (citizenUnits != 0)
//            {
//                uint nextUnit = instance.m_units.m_buffer[citizenUnits].m_nextUnit;
//                for (int i = 0; i < 5; i++)
//                {
//                    uint citizen = instance.m_units.m_buffer[citizenUnits].GetCitizen(i);
//                    if (citizen != 0)
//                    {
//                        ushort index = instance.m_citizens.m_buffer[citizen].m_instance;
//                        if ((index != 0) && (instance.m_instances.m_buffer[index].m_targetBuilding == citizenData.m_targetBuilding))
//                        {
//                            instance.m_citizens.m_buffer[citizenData.m_citizen].SetVehicle(citizenData.m_citizen, vehicleID, 0);
//                            if (instance.m_citizens.m_buffer[citizenData.m_citizen].m_vehicle == vehicleID)
//                            {
//                                if (citizenData.m_path != 0)
//                                {
//                                    Singleton<PathManager>.instance.ReleasePath(citizenData.m_path);
//                                    citizenData.m_path = 0;
//                                }
//                                return true;
//                            }
//                        }
//                        break;
//                    }
//                }
//                citizenUnits = nextUnit;
//                if (++num2 > 0x80000)
//                {
//                    CODebugBase<LogChannel>.Error(LogChannel.Core, "Invalid list detected!\n" + System.Environment.StackTrace);
//                    break;
//                }
//            }
//        }
//        return false;
//    }
    
//    public void TryMoveAwayFromHome(uint citizenID, ref Citizen data)
//    {
//        if (!data.Dead && (data.m_homeBuilding != 0))
//        {
//            Citizen.AgeGroup ageGroup = Citizen.GetAgeGroup(data.Age);
//            switch (ageGroup)
//            {
//                case Citizen.AgeGroup.Young:
//                case Citizen.AgeGroup.Adult:
//                {
//                    TransferManager.TransferOffer offer = new TransferManager.TransferOffer();
//                    if (ageGroup == Citizen.AgeGroup.Young)
//                    {
//                        offer.Priority = 1;
//                    }
//                    else
//                    {
//                        offer.Priority = Singleton<SimulationManager>.instance.m_randomizer.Int32(2, 4);
//                    }
//                    offer.Citizen = citizenID;
//                    offer.Position = Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_homeBuilding].m_position;
//                    offer.Amount = 1;
//                    offer.Active = true;
//                    if (Singleton<SimulationManager>.instance.m_randomizer.Int32(2) == 0)
//                    {
//                        switch (data.EducationLevel)
//                        {
//                            case Citizen.Education.Uneducated:
//                                Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single0, offer);
//                                return;
                            
//                            case Citizen.Education.OneSchool:
//                                Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single1, offer);
//                                return;
                            
//                            case Citizen.Education.TwoSchools:
//                                Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single2, offer);
//                                return;
                            
//                            case Citizen.Education.ThreeSchools:
//                                Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single3, offer);
//                                return;
//                        }
//                    }
//                    else
//                    {
//                        switch (data.EducationLevel)
//                        {
//                            case Citizen.Education.Uneducated:
//                                Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single0B, offer);
//                                return;
                            
//                            case Citizen.Education.OneSchool:
//                                Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single1B, offer);
//                                return;
                            
//                            case Citizen.Education.TwoSchools:
//                                Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single2B, offer);
//                                return;
                            
//                            case Citizen.Education.ThreeSchools:
//                                Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single3B, offer);
//                                return;
//                        }
//                    }
//                    break;
//                }
//            }
//        }
//    }
    
//    public void TryMoveFamily(uint citizenID, ref Citizen data, int familySize)
//    {
//        if (!data.Dead && (data.m_homeBuilding != 0))
//        {
//            TransferManager.TransferOffer offer = new TransferManager.TransferOffer {
//                Priority = Singleton<SimulationManager>.instance.m_randomizer.Int32(1, 7),
//                Citizen = citizenID,
//                Position = Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_homeBuilding].m_position,
//                Amount = 1,
//                Active = true
//            };
//            if (familySize == 1)
//            {
//                if (Singleton<SimulationManager>.instance.m_randomizer.Int32(2) == 0)
//                {
//                    switch (data.EducationLevel)
//                    {
//                        case Citizen.Education.Uneducated:
//                            Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single0, offer);
//                            break;
                        
//                        case Citizen.Education.OneSchool:
//                            Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single1, offer);
//                            break;
                        
//                        case Citizen.Education.TwoSchools:
//                            Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single2, offer);
//                            break;
                        
//                        case Citizen.Education.ThreeSchools:
//                            Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single3, offer);
//                            break;
//                    }
//                }
//                else
//                {
//                    switch (data.EducationLevel)
//                    {
//                        case Citizen.Education.Uneducated:
//                            Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single0B, offer);
//                            break;
                        
//                        case Citizen.Education.OneSchool:
//                            Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single1B, offer);
//                            break;
                        
//                        case Citizen.Education.TwoSchools:
//                            Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single2B, offer);
//                            break;
                        
//                        case Citizen.Education.ThreeSchools:
//                            Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single3B, offer);
//                            break;
//                    }
//                }
//            }
//            else
//            {
//                switch (data.EducationLevel)
//                {
//                    case Citizen.Education.Uneducated:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Family0, offer);
//                        break;
                    
//                    case Citizen.Education.OneSchool:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Family1, offer);
//                        break;
                    
//                    case Citizen.Education.TwoSchools:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Family2, offer);
//                        break;
                    
//                    case Citizen.Education.ThreeSchools:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Family3, offer);
//                        break;
//                }
//            }
//        }
//    }
    
//    private bool UpdateAge(uint citizenID, ref Citizen data)
//    {
//        int num = data.Age + 1;
//        if (num <= 0x2d)
//        {
//            switch (num)
//            {
//                case 15:
//                case 0x2d:
//                    this.FinishSchoolOrWork(citizenID, ref data);
//                    break;
//            }
//        }
//        else
//        {
//            switch (num)
//            {
//                case 90:
//                case 180:
//                    this.FinishSchoolOrWork(citizenID, ref data);
//                    goto Label_006D;
//            }
//            if (((data.m_flags & Citizen.Flags.Student) != Citizen.Flags.None) && ((num % 15) == 0))
//            {
//                this.FinishSchoolOrWork(citizenID, ref data);
//            }
//        }
//    Label_006D:
//        if ((data.m_flags & Citizen.Flags.Original) != Citizen.Flags.None)
//        {
//            CitizenManager instance = Singleton<CitizenManager>.instance;
//            if (instance.m_tempOldestOriginalResident < num)
//            {
//                instance.m_tempOldestOriginalResident = num;
//            }
//            if (num == 240)
//            {
//                Singleton<StatisticsManager>.instance.Acquire<StatisticInt32>(StatisticType.FullLifespans).Add(1);
//            }
//        }
//        data.Age = num;
//        if (((num >= 240) && (data.CurrentLocation != Citizen.Location.Moving)) && ((data.m_vehicle == 0) && (Singleton<SimulationManager>.instance.m_randomizer.Int32(240, 0xff) <= num)))
//        {
//            this.Die(citizenID, ref data);
//            if (Singleton<SimulationManager>.instance.m_randomizer.Int32(2) == 0)
//            {
//                Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//                return true;
//            }
//        }
//        return false;
//    }
    
//    private bool UpdateHealth(uint citizenID, ref Citizen data)
//    {
//        if (data.m_homeBuilding != 0)
//        {
//            int num3;
//            int num4;
//            int num6;
//            int num7;
//            int num8;
//            int num9;
//            bool flag;
//            bool flag2;
//            byte num10;
//            byte num13;
//            int num = 20;
//            BuildingManager instance = Singleton<BuildingManager>.instance;
//            BuildingInfo info = instance.m_buildings.m_buffer[data.m_homeBuilding].Info;
//            Vector3 position = instance.m_buildings.m_buffer[data.m_homeBuilding].m_position;
//            DistrictManager manager2 = Singleton<DistrictManager>.instance;
//            byte district = manager2.GetDistrict(position);
//            if ((manager2.m_districts.m_buffer[district].m_servicePolicies & DistrictPolicies.Services.SmokingBan) != DistrictPolicies.Services.None)
//            {
//                num += 10;
//            }
//            info.m_buildingAI.GetMaterialAmount(data.m_homeBuilding, ref instance.m_buildings.m_buffer[data.m_homeBuilding], TransferManager.TransferReason.Garbage, out num3, out num4);
//            num3 /= 0x3e8;
//            if (num3 <= 2)
//            {
//                num += 12;
//            }
//            else if (num3 >= 4)
//            {
//                num -= num3 - 3;
//            }
//            int healthCareRequirement = Citizen.GetHealthCareRequirement(Citizen.GetAgePhase(data.EducationLevel, data.Age));
//            Singleton<ImmaterialResourceManager>.instance.CheckResource(ImmaterialResourceManager.Resource.HealthCare, position, out num6, out num7);
//            if (healthCareRequirement != 0)
//            {
//                if (num6 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num6, healthCareRequirement, 500, 20, 40);
//                }
//                if (num7 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num7, healthCareRequirement >> 1, 250, 5, 20);
//                }
//            }
//            Singleton<ImmaterialResourceManager>.instance.CheckLocalResource(ImmaterialResourceManager.Resource.NoisePollution, position, out num8);
//            if (num8 != 0)
//            {
//                num -= (num8 * 100) / 0xff;
//            }
//            Singleton<ImmaterialResourceManager>.instance.CheckLocalResource(ImmaterialResourceManager.Resource.CrimeRate, position, out num9);
//            if (num9 > 3)
//            {
//                if (num9 <= 30)
//                {
//                    num -= 2;
//                }
//                else if (num9 <= 70)
//                {
//                    num -= 5;
//                }
//                else
//                {
//                    num -= 15;
//                }
//            }
//            Singleton<WaterManager>.instance.CheckWater(position, out flag, out flag2, out num10);
//            if (flag)
//            {
//                num += 12;
//                data.NoWater = 0;
//            }
//            else
//            {
//                int noWater = data.NoWater;
//                if (noWater < 2)
//                {
//                    data.NoWater = noWater + 1;
//                }
//                else
//                {
//                    num -= 5;
//                }
//            }
//            if (flag2)
//            {
//                num += 12;
//                data.NoSewage = 0;
//            }
//            else
//            {
//                int noSewage = data.NoSewage;
//                if (noSewage < 2)
//                {
//                    data.NoSewage = noSewage + 1;
//                }
//                else
//                {
//                    num -= 5;
//                }
//            }
//            if (num10 < 0x23)
//            {
//                num -= num10;
//            }
//            else
//            {
//                num -= (num10 * 2) - 0x23;
//            }
//            Singleton<NaturalResourceManager>.instance.CheckPollution(position, out num13);
//            num -= (num13 * 100) / 0xff;
//            num = Mathf.Clamp(num, 0, 100);
//            data.m_health = (byte) num;
//            int num14 = 0;
//            if (num <= 10)
//            {
//                int badHealth = data.BadHealth;
//                if (badHealth < 3)
//                {
//                    num14 = 15;
//                    data.BadHealth = badHealth + 1;
//                }
//                else if (num7 == 0)
//                {
//                    num14 = 0x4b;
//                }
//                else
//                {
//                    num14 = 50;
//                }
//            }
//            else if (num <= 0x19)
//            {
//                data.BadHealth = 0;
//                num14 += 10;
//            }
//            else if (num <= 50)
//            {
//                data.BadHealth = 0;
//                num14 += 3;
//            }
//            else
//            {
//                data.BadHealth = 0;
//            }
//            if (((data.CurrentLocation != Citizen.Location.Moving) && (data.m_vehicle == 0)) && ((num14 != 0) && (Singleton<SimulationManager>.instance.m_randomizer.Int32(100) < num14)))
//            {
//                if (Singleton<SimulationManager>.instance.m_randomizer.Int32(3) == 0)
//                {
//                    this.Die(citizenID, ref data);
//                    if (Singleton<SimulationManager>.instance.m_randomizer.Int32(2) == 0)
//                    {
//                        Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//                        return true;
//                    }
//                }
//                else
//                {
//                    data.Sick = true;
//                }
//            }
//        }
//        return false;
//    }
    
//    private void UpdateHome(uint citizenID, ref Citizen data)
//    {
//        if ((data.m_homeBuilding == 0) && ((data.m_flags & Citizen.Flags.DummyTraffic) == Citizen.Flags.None))
//        {
//            TransferManager.TransferOffer offer = new TransferManager.TransferOffer {
//                Priority = 7,
//                Citizen = citizenID,
//                Amount = 1,
//                Active = true
//            };
//            if (data.m_workBuilding != 0)
//            {
//                BuildingManager instance = Singleton<BuildingManager>.instance;
//                offer.Position = instance.m_buildings.m_buffer[data.m_workBuilding].m_position;
//            }
//            else
//            {
//                offer.PositionX = Singleton<SimulationManager>.instance.m_randomizer.Int32(0x100);
//                offer.PositionZ = Singleton<SimulationManager>.instance.m_randomizer.Int32(0x100);
//            }
//            if (Singleton<SimulationManager>.instance.m_randomizer.Int32(2) == 0)
//            {
//                switch (data.EducationLevel)
//                {
//                    case Citizen.Education.Uneducated:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single0, offer);
//                        break;
                    
//                    case Citizen.Education.OneSchool:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single1, offer);
//                        break;
                    
//                    case Citizen.Education.TwoSchools:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single2, offer);
//                        break;
                    
//                    case Citizen.Education.ThreeSchools:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single3, offer);
//                        break;
//                }
//            }
//            else
//            {
//                switch (data.EducationLevel)
//                {
//                    case Citizen.Education.Uneducated:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single0B, offer);
//                        break;
                    
//                    case Citizen.Education.OneSchool:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single1B, offer);
//                        break;
                    
//                    case Citizen.Education.TwoSchools:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single2B, offer);
//                        break;
                    
//                    case Citizen.Education.ThreeSchools:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Single3B, offer);
//                        break;
//                }
//            }
//        }
//    }
    
//    private void UpdateLocation(uint citizenID, ref Citizen data)
//    {
//        if ((((data.m_homeBuilding == 0) && (data.m_workBuilding == 0)) && ((data.m_visitBuilding == 0) && (data.m_instance == 0))) && (data.m_vehicle == 0))
//        {
//            Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//        }
//        else
//        {
//            switch (data.CurrentLocation)
//            {
//                case Citizen.Location.Home:
//                    if ((data.m_flags & Citizen.Flags.MovingIn) == Citizen.Flags.None)
//                    {
//                        if (data.Dead)
//                        {
//                            if (data.m_homeBuilding == 0)
//                            {
//                                Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//                                return;
//                            }
//                            if (data.m_workBuilding != 0)
//                            {
//                                data.SetWorkplace(citizenID, 0, 0);
//                            }
//                            if (data.m_visitBuilding != 0)
//                            {
//                                data.SetVisitplace(citizenID, 0, 0);
//                            }
//                            if ((data.m_vehicle == 0) && !this.FindHospital(citizenID, data.m_homeBuilding, TransferManager.TransferReason.Dead))
//                            {
//                                return;
//                            }
//                        }
//                        else if (data.Sick)
//                        {
//                            if (((data.m_homeBuilding != 0) && (data.m_vehicle == 0)) && !this.FindHospital(citizenID, data.m_homeBuilding, TransferManager.TransferReason.Sick))
//                            {
//                                return;
//                            }
//                        }
//                        else if ((data.m_flags & Citizen.Flags.NeedGoods) != Citizen.Flags.None)
//                        {
//                            if (((data.m_homeBuilding != 0) && (data.m_instance == 0)) && (data.m_vehicle == 0))
//                            {
//                                base.FindVisitPlace(citizenID, data.m_homeBuilding, this.GetShoppingReason());
//                            }
//                        }
//                        else if (((data.m_instance != 0) || this.DoRandomMove()) && data.m_workBuilding != 0)
//                        {
//                            BuildingManager instance = Singleton<BuildingManager>.instance;
//                            BuildingInfo info = instance.m_buildings.m_buffer[data.m_workBuilding].Info;

//                            int num = Singleton<SimulationManager>.instance.m_randomizer.Int32(40);
//                            if (num == 0)
//                            {
//                                if ((data.m_instance == 0) && (data.m_vehicle == 0))
//                                {
//                                    base.FindVisitPlace(citizenID, data.m_workBuilding, this.GetEntertainmentReason());
//                                }
//                            }
//                            else {
//                                var numChance = 10;
//                                if (info.m_class.m_service == ItemClass.Service.Office)
//                                {
//                                    numChance = 30;
//                                }
//                                if ((((num < numChance) && (data.m_homeBuilding != 0)) &&  (data.m_instance == 0)) && (data.m_vehicle == 0))
//                                {                                   
//                                    if (base.StartMoving(citizenID, ref data, data.m_homeBuilding, data.m_workBuilding))
//                                    {
//                                        BuildingInfo homeInfo = instance.m_buildings.m_buffer[data.m_homeBuilding].Info;
//                                        int amountDelta = 60;
//                                        instance.m_buildings.m_buffer[data.m_homeBuilding].Info.m_buildingAI.ModifyMaterialBuffer(data.m_homeBuilding, ref instance.m_buildings.m_buffer[data.m_homeBuilding], TransferManager.TransferReason.Worker0, ref amountDelta);
//                                    }
//                                }
//                            }
//                        }
//                        break;
//                    }
//                    Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//                    return;
                
//                case Citizen.Location.Work:
//                    if (!data.Dead)
//                    {
//                        if (data.Sick)
//                        {
//                            if (data.m_workBuilding != 0)
//                            {
//                                if ((data.m_vehicle == 0) && !this.FindHospital(citizenID, data.m_workBuilding, TransferManager.TransferReason.Sick))
//                                {
//                                    return;
//                                }
//                            }
//                            else
//                            {
//                                data.CurrentLocation = Citizen.Location.Home;
//                            }
//                        }
//                        else if ((data.m_flags & Citizen.Flags.NeedGoods) != Citizen.Flags.None)
//                        {
//                            if (data.m_workBuilding == 0)
//                            {
//                                data.CurrentLocation = Citizen.Location.Home;
//                            }
//                            else if ((data.m_instance == 0) && (data.m_vehicle == 0))
//                            {
//                                base.FindVisitPlace(citizenID, data.m_workBuilding, this.GetShoppingReason());
//                            }
//                        }
//                        else if (data.m_workBuilding == 0)
//                        {
//                            data.CurrentLocation = Citizen.Location.Home;
//                        }
//                        else if ((data.m_instance != 0) || this.DoRandomMove())
//                        {
//                            int num2 = Singleton<SimulationManager>.instance.m_randomizer.Int32(40);
//                            if (num2 == 0)
//                            {
//                                if ((data.m_instance == 0) && (data.m_vehicle == 0))
//                                {
//                                    base.FindVisitPlace(citizenID, data.m_workBuilding, this.GetEntertainmentReason());
//                                }
//                            }
//                            else if (((num2 < 10) && (data.m_homeBuilding != 0)) && ((data.m_instance == 0) && (data.m_vehicle == 0)))
//                            {
//                                base.StartMoving(citizenID, ref data, data.m_workBuilding, data.m_homeBuilding);
//                            }
//                        }
//                        break;
//                    }
//                    if (data.m_workBuilding != 0)
//                    {
//                        if (data.m_homeBuilding != 0)
//                        {
//                            data.SetHome(citizenID, 0, 0);
//                        }
//                        if (data.m_visitBuilding != 0)
//                        {
//                            data.SetVisitplace(citizenID, 0, 0);
//                        }
//                        if ((data.m_vehicle != 0) || this.FindHospital(citizenID, data.m_workBuilding, TransferManager.TransferReason.Dead))
//                        {
//                            break;
//                        }
//                        return;
//                    }
//                    Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//                    return;
                
//                case Citizen.Location.Visit:
//                    if (!data.Dead)
//                    {
//                        if (data.Sick)
//                        {
//                            if (data.m_visitBuilding != 0)
//                            {
//                                if (((data.m_vehicle == 0) && (Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_visitBuilding].Info.m_class.m_service != ItemClass.Service.HealthCare)) && !this.FindHospital(citizenID, data.m_visitBuilding, TransferManager.TransferReason.Sick))
//                                {
//                                    return;
//                                }
//                            }
//                            else
//                            {
//                                data.CurrentLocation = Citizen.Location.Home;
//                            }
//                        }
//                        else if ((data.m_flags & Citizen.Flags.NeedGoods) != Citizen.Flags.None)
//                        {
//                            if (data.m_visitBuilding == 0)
//                            {
//                                data.CurrentLocation = Citizen.Location.Home;
//                            }
//                            else
//                            {
//                                BuildingManager instance = Singleton<BuildingManager>.instance;
//                                BuildingInfo info = instance.m_buildings.m_buffer[data.m_visitBuilding].Info;
//                                int amountDelta = -100;
//                                info.m_buildingAI.ModifyMaterialBuffer(data.m_visitBuilding, ref instance.m_buildings.m_buffer[data.m_visitBuilding], TransferManager.TransferReason.Shopping, ref amountDelta);
//                            }
//                        }
//                        else if (data.m_visitBuilding == 0)
//                        {
//                            data.CurrentLocation = Citizen.Location.Home;
//                        }
//                        else if (((data.m_instance != 0) || this.DoRandomMove()) && (((Singleton<SimulationManager>.instance.m_randomizer.Int32(40) < 10) && (data.m_homeBuilding != 0)) && ((data.m_instance == 0) && (data.m_vehicle == 0))))
//                        {
//                            base.StartMoving(citizenID, ref data, data.m_visitBuilding, data.m_homeBuilding);
//                            data.SetVisitplace(citizenID, 0, 0);
//                        }
//                        break;
//                    }
//                    if (data.m_visitBuilding != 0)
//                    {
//                        if (data.m_homeBuilding != 0)
//                        {
//                            data.SetHome(citizenID, 0, 0);
//                        }
//                        if (data.m_workBuilding != 0)
//                        {
//                            data.SetWorkplace(citizenID, 0, 0);
//                        }
//                        if (((data.m_vehicle != 0) || (Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_visitBuilding].Info.m_class.m_service == ItemClass.Service.HealthCare)) || this.FindHospital(citizenID, data.m_visitBuilding, TransferManager.TransferReason.Dead))
//                        {
//                            break;
//                        }
//                        return;
//                    }
//                    Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//                    return;
                
//                case Citizen.Location.Moving:
//                    if (!data.Dead)
//                    {
//                        if ((data.m_vehicle == 0) && (data.m_instance == 0))
//                        {
//                            if (data.m_visitBuilding != 0)
//                            {
//                                data.SetVisitplace(citizenID, 0, 0);
//                            }
//                            data.CurrentLocation = Citizen.Location.Home;
//                        }
//                        break;
//                    }
//                    if (data.m_vehicle != 0)
//                    {
//                        if (data.m_homeBuilding != 0)
//                        {
//                            data.SetHome(citizenID, 0, 0);
//                        }
//                        if (data.m_workBuilding != 0)
//                        {
//                            data.SetWorkplace(citizenID, 0, 0);
//                        }
//                        if (data.m_visitBuilding != 0)
//                        {
//                            data.SetVisitplace(citizenID, 0, 0);
//                        }
//                        break;
//                    }
//                    Singleton<CitizenManager>.instance.ReleaseCitizen(citizenID);
//                    return;
//            }
//            data.m_flags &= ~Citizen.Flags.NeedGoods;
//        }
//    }
    
//    private void UpdateWellbeing(uint citizenID, ref Citizen data)
//    {
//        if (data.m_homeBuilding != 0)
//        {
//            int num23;
//            int num24;
//            bool flag;
//            int num = 0;
//            BuildingManager instance = Singleton<BuildingManager>.instance;
//            BuildingInfo info = instance.m_buildings.m_buffer[data.m_homeBuilding].Info;
//            Vector3 position = instance.m_buildings.m_buffer[data.m_homeBuilding].m_position;
//            ItemClass itemClass = info.m_class;
//            DistrictManager manager2 = Singleton<DistrictManager>.instance;
//            byte district = manager2.GetDistrict(position);
//            DistrictPolicies.Services servicePolicies = manager2.m_districts.m_buffer[district].m_servicePolicies;
//            DistrictPolicies.Taxation taxationPolicies = manager2.m_districts.m_buffer[district].m_taxationPolicies;
//            DistrictPolicies.Special specialPolicies = manager2.m_districts.m_buffer[district].m_specialPolicies;
//            int health = data.m_health;
//            if (health > 80)
//            {
//                num += 5;
//            }
//            else if (health > 60)
//            {
//                num += 5;
//            }
//            num -= Mathf.Clamp(50 - health, 0, 30);
//            if ((servicePolicies & DistrictPolicies.Services.PetBan) != DistrictPolicies.Services.None)
//            {
//                num -= 5;
//            }
//            if ((servicePolicies & DistrictPolicies.Services.SmokingBan) != DistrictPolicies.Services.None)
//            {
//                num -= 15;
//            }
//            if ((specialPolicies & DistrictPolicies.Special.AllowWeapons) != DistrictPolicies.Special.None)
//            {
//                num += 5;
//            }
//            if (instance.m_buildings.m_buffer[data.m_homeBuilding].GetLastFrameData().m_fireDamage != 0)
//            {
//                num -= 15;
//            }
//            Citizen.Wealth wealthLevel = data.WealthLevel;
//            Citizen.AgePhase agePhase = Citizen.GetAgePhase(data.EducationLevel, data.Age);
//            int taxRate = Singleton<EconomyManager>.instance.GetTaxRate(itemClass, taxationPolicies) + 4;
//            int num5 = 8 - (int)wealthLevel;
//            int num6 = 11 - (int)wealthLevel;
//            if (itemClass.m_subService == ItemClass.SubService.ResidentialHigh)
//            {
//                num5++;
//                num6++;
//            }
//            if (taxRate < num5)
//            {
//                num += num5 - taxRate;
//            }
//            if (taxRate > num6)
//            {
//                num -= taxRate - num6;
//            }
//            int policeDepartmentRequirement = Citizen.GetPoliceDepartmentRequirement(agePhase);
//            if (policeDepartmentRequirement != 0)
//            {
//                int num8;
//                int num9;
//                Singleton<ImmaterialResourceManager>.instance.CheckResource(ImmaterialResourceManager.Resource.PoliceDepartment, position, out num8, out num9);
//                if (num8 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num8, policeDepartmentRequirement, 500, 20, 40);
//                }
//                if (num9 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num9, policeDepartmentRequirement >> 1, 250, 5, 20);
//                }
//            }
//            int fireDepartmentRequirement = Citizen.GetFireDepartmentRequirement(agePhase);
//            if (fireDepartmentRequirement != 0)
//            {
//                int num11;
//                int num12;
//                Singleton<ImmaterialResourceManager>.instance.CheckResource(ImmaterialResourceManager.Resource.FireDepartment, position, out num11, out num12);
//                if (num11 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num11, fireDepartmentRequirement, 500, 20, 40);
//                }
//                if (num12 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num12, fireDepartmentRequirement >> 1, 250, 5, 20);
//                }
//            }
//            int educationRequirement = Citizen.GetEducationRequirement(agePhase);
//            if (educationRequirement != 0)
//            {
//                int num14;
//                int num15;
//                if (agePhase < Citizen.AgePhase.Teen0)
//                {
//                    Singleton<ImmaterialResourceManager>.instance.CheckResource(ImmaterialResourceManager.Resource.EducationElementary, position, out num14, out num15);
//                    if (((num14 > 0x3e8) && !data.Education1) && (Singleton<SimulationManager>.instance.m_randomizer.Int32(0x2328) < (num14 - 0x3e8)))
//                    {
//                        data.Education1 = true;
//                    }
//                }
//                else if (agePhase < Citizen.AgePhase.Young0)
//                {
//                    Singleton<ImmaterialResourceManager>.instance.CheckResource(ImmaterialResourceManager.Resource.EducationHighSchool, position, out num14, out num15);
//                    if (((num14 > 0x3e8) && !data.Education2) && (Singleton<SimulationManager>.instance.m_randomizer.Int32(0x2328) < (num14 - 0x3e8)))
//                    {
//                        data.Education2 = true;
//                    }
//                }
//                else
//                {
//                    Singleton<ImmaterialResourceManager>.instance.CheckResource(ImmaterialResourceManager.Resource.EducationUniversity, position, out num14, out num15);
//                    if (((num14 > 0x3e8) && !data.Education3) && (Singleton<SimulationManager>.instance.m_randomizer.Int32(0x2328) < (num14 - 0x3e8)))
//                    {
//                        data.Education3 = true;
//                    }
//                }
//                if (num14 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num14, educationRequirement, 500, 20, 40);
//                }
//                if (num15 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num15, educationRequirement >> 1, 250, 5, 20);
//                }
//            }
//            int entertainmentRequirement = Citizen.GetEntertainmentRequirement(agePhase);
//            if (entertainmentRequirement != 0)
//            {
//                int num17;
//                int num18;
//                Singleton<ImmaterialResourceManager>.instance.CheckResource(ImmaterialResourceManager.Resource.Entertainment, position, out num17, out num18);
//                if (num17 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num17, entertainmentRequirement, 500, 30, 60);
//                }
//                if (num18 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num18, entertainmentRequirement >> 1, 250, 10, 40);
//                }
//            }
//            int transportRequirement = Citizen.GetTransportRequirement(agePhase);
//            if (transportRequirement != 0)
//            {
//                int num20;
//                int num21;
//                Singleton<ImmaterialResourceManager>.instance.CheckResource(ImmaterialResourceManager.Resource.PublicTransport, position, out num20, out num21);
//                if (num20 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num20, transportRequirement, 500, 20, 40);
//                }
//                if (num21 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num21, transportRequirement >> 1, 250, 5, 20);
//                }
//            }
//            int deathCareRequirement = Citizen.GetDeathCareRequirement(agePhase);
//            Singleton<ImmaterialResourceManager>.instance.CheckResource(ImmaterialResourceManager.Resource.DeathCare, position, out num23, out num24);
//            if (deathCareRequirement != 0)
//            {
//                if (num23 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num23, deathCareRequirement, 500, 10, 20);
//                }
//                if (num24 != 0)
//                {
//                    num += ImmaterialResourceManager.CalculateResourceEffect(num24, deathCareRequirement >> 1, 250, 3, 10);
//                }
//            }
//            Singleton<ElectricityManager>.instance.CheckElectricity(position, out flag);
//            if (flag)
//            {
//                num += 12;
//                data.NoElectricity = 0;
//            }
//            else
//            {
//                int noElectricity = data.NoElectricity;
//                if (noElectricity < 2)
//                {
//                    data.NoElectricity = noElectricity + 1;
//                }
//                else
//                {
//                    num -= 5;
//                }
//            }
//            int workRequirement = Citizen.GetWorkRequirement(agePhase);
//            if (workRequirement != 0)
//            {
//                if (data.m_workBuilding == 0)
//                {
//                    int unemployed = data.Unemployed;
//                    num -= (unemployed * workRequirement) / 100;
//                    if (Singleton<UnlockManager>.instance.Unlocked(ItemClass.Service.PoliceDepartment))
//                    {
//                        data.Unemployed = unemployed + 1;
//                    }
//                    else
//                    {
//                        data.Unemployed = Mathf.Min(1, unemployed + 1);
//                    }
//                }
//                else
//                {
//                    data.Unemployed = 0;
//                }
//            }
//            else
//            {
//                data.Unemployed = 0;
//            }
//            num = Mathf.Clamp(num, 0, 100);
//            data.m_wellbeing = (byte) num;
//        }
//    }
    
//    private void UpdateWorkplace(uint citizenID, ref Citizen data)
//    {
//        if ((data.m_workBuilding == 0) && (data.m_homeBuilding != 0))
//        {
//            Vector3 position = Singleton<BuildingManager>.instance.m_buildings.m_buffer[data.m_homeBuilding].m_position;
//            DistrictManager instance = Singleton<DistrictManager>.instance;
//            byte district = instance.GetDistrict(position);
//            DistrictPolicies.Services servicePolicies = instance.m_districts.m_buffer[district].m_servicePolicies;
//            int age = data.Age;
//            TransferManager.TransferReason none = TransferManager.TransferReason.None;
//            switch (Citizen.GetAgeGroup(age))
//            {
//                case Citizen.AgeGroup.Child:
//                    if (!data.Education1)
//                    {
//                        none = TransferManager.TransferReason.Student1;
//                    }
//                    break;
                
//                case Citizen.AgeGroup.Teen:
//                    if (!data.Education2)
//                    {
//                        none = TransferManager.TransferReason.Student2;
//                    }
//                    break;
                
//                case Citizen.AgeGroup.Young:
//                case Citizen.AgeGroup.Adult:
//                    if (!data.Education3)
//                    {
//                        none = TransferManager.TransferReason.Student3;
//                    }
//                    break;
//            }
//            if (((data.Unemployed != 0) && (data.m_homeBuilding != 0)) && ((((servicePolicies & DistrictPolicies.Services.EducationBoost) == DistrictPolicies.Services.None) || (none != TransferManager.TransferReason.Student3)) || ((age % 5) > 2)))
//            {
//                TransferManager.TransferOffer offer = new TransferManager.TransferOffer {
//                    Priority = Singleton<SimulationManager>.instance.m_randomizer.Int32(8),
//                    Citizen = citizenID,
//                    Position = position,
//                    Amount = 1,
//                    Active = true
//                };
//                switch (data.EducationLevel)
//                {
//                    case Citizen.Education.Uneducated:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Worker0, offer);
//                        break;
                    
//                    case Citizen.Education.OneSchool:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Worker1, offer);
//                        break;
                    
//                    case Citizen.Education.TwoSchools:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Worker2, offer);
//                        break;
                    
//                    case Citizen.Education.ThreeSchools:
//                        Singleton<TransferManager>.instance.AddOutgoingOffer(TransferManager.TransferReason.Worker3, offer);
//                        break;
//                }
//            }
//            if (none != TransferManager.TransferReason.None)
//            {
//                TransferManager.TransferOffer offer2 = new TransferManager.TransferOffer {
//                    Priority = Singleton<SimulationManager>.instance.m_randomizer.Int32(8),
//                    Citizen = citizenID,
//                    Position = position,
//                    Amount = 1,
//                    Active = true
//                };
//                Singleton<TransferManager>.instance.AddOutgoingOffer(none, offer2);
//            }
//        }
//    }
//}
